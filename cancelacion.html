<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Agrega las metaetiquetas necesarias y los enlaces de estilo según tus necesidades -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancelar Arriendo</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
    </style>
</head>
<body>

    <h2>Cancelar Arriendo</h2>

    <form id="buscarForm">
        <label>Buscar por:</label>
        <select id="buscarPor" name="buscarPor">
            <option value="numeroOrden">Número de Orden</option>
            <option value="rutCliente">RUT del Cliente</option>
        </select>

        <label id="labelNumeroOrden" style="display:none;" for="buscarNumeroOrden">Número de Orden:</label>
        <input type="text" id="buscarNumeroOrden" name="buscarNumeroOrden">

        <label id="labelRutCliente" style="display:none;" for="buscarRutCliente">RUT del Cliente:</label>
        <input type="text" id="buscarRutCliente" name="buscarRutCliente">

        <button type="button" onclick="buscarArriendo()">Buscar Arriendo</button>
    </form>

    <div id="resultadoArriendo">
        <!-- Aquí se mostrará el resultado de la búsqueda -->
    </div>

    <script>
        function buscarArriendo() {
            var opcionSeleccionada = $("#buscarPor").val();

            if (opcionSeleccionada === "numeroOrden") {
                buscarPorNumeroOrden();
            } else if (opcionSeleccionada === "rutCliente") {
                buscarPorRutCliente();
            }
        }

        function buscarPorNumeroOrden() {
            var numeroOrden = $("#buscarNumeroOrden").val();

            // Obtener datos del almacenamiento local
            var datosGuardados = JSON.parse(localStorage.getItem('datosArriendo_' + numeroOrden));

            if (datosGuardados) {
                mostrarInformacionArriendo(datosGuardados);
            } else {
                // Mostrar mensaje si no se encuentra el arriendo
                $("#resultadoArriendo").html("<p>No se encontró un arriendo con el número de orden proporcionado.</p>");
            }
        }

        function buscarPorRutCliente() {
            var rutCliente = $("#buscarRutCliente").val();

            // Iterar sobre todas las claves del almacenamiento local
            for (var i = 0; i < localStorage.length; i++) {
                var clave = localStorage.key(i);

                // Verificar si la clave corresponde a un arriendo y si el RUT coincide
                if (clave.startsWith('datosArriendo_')) {
                    var datosGuardados = JSON.parse(localStorage.getItem(clave));

                    if (datosGuardados && datosGuardados.length > 0 && datosGuardados[1].value === rutCliente) {
                        mostrarInformacionArriendo(datosGuardados);
                        return; // Detener la búsqueda después de encontrar el primer arriendo
                    }
                }
            }

            // Mostrar mensaje si no se encuentra el arriendo
            $("#resultadoArriendo").html("<p>No se encontró un arriendo con el RUT proporcionado.</p>");
        }

        function mostrarInformacionArriendo(datosGuardados) {
            // Mostrar información del arriendo
            var resultadoHTML = "<h3>Información del Arriendo</h3>";
            resultadoHTML += "<p>Número de Orden: " + datosGuardados[0].value + "</p>";
            resultadoHTML += "<p>Vehículo Arrendado: " + datosGuardados[datosGuardados.length - 1].value + "</p>";
            resultadoHTML += "<p>Estado: " + datosGuardados[datosGuardados.length - 2].value + "</p>";
            resultadoHTML += "<button onclick=\"cancelarArriendo('" + datosGuardados[0].value + "')\">Cancelar Arriendo</button>"; // Agrega un botón para cancelar

            $("#resultadoArriendo").html(resultadoHTML);
        }

        function cancelarArriendo(numeroOrden) {
            // Obtener datos del almacenamiento local
            var datosGuardados = JSON.parse(localStorage.getItem('datosArriendo_' + numeroOrden));

            // Cambiar el estado a "Cancelado"
            datosGuardados[datosGuardados.length - 2].value = "Cancelado";

            // Actualizar datos en el almacenamiento local
            localStorage.setItem('datosArriendo_' + numeroOrden, JSON.stringify(datosGuardados));

            // Volver a mostrar la información con el estado actualizado
            mostrarInformacionArriendo(datosGuardados);
        }

        // Mostrar u ocultar los campos de búsqueda según la opción seleccionada
        $("#buscarPor").change(function () {
            var opcionSeleccionada = $("#buscarPor").val();

            if (opcionSeleccionada === "numeroOrden") {
                $("#labelNumeroOrden").show();
                $("#buscarNumeroOrden").show();

                $("#labelRutCliente").hide();
                $("#buscarRutCliente").hide();
            } else if (opcionSeleccionada === "rutCliente") {
                $("#labelNumeroOrden").hide();
                $("#buscarNumeroOrden").hide();

                $("#labelRutCliente").show();
                $("#buscarRutCliente").show();
            }
        });
    </script>
</body>
</html>
